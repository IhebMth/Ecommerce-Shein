<!DOCTYPE html>
<html lang="en" dir="ltr" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NOVA ‚Äì Style That Speaks Before You Do | Fashion Store</title>

<!-- SEO Meta Tags -->
<meta name="description" content="Shop NOVA's curated fashion collection ‚Äî leggings, sneakers, accessories, arm sleeves & more. Premium quality. Cash on delivery. Fast shipping.">
<meta name="keywords" content="fashion store, leggings, sneakers, accessories, arm sleeves, t-shirts, online shopping, NOVA fashion">
<meta name="author" content="NOVA Fashion">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://novafashion.store/">

<!-- Open Graph -->
<meta property="og:type" content="website">
<meta property="og:site_name" content="NOVA Fashion">
<meta property="og:title" content="NOVA ‚Äì Style That Speaks Before You Do">
<meta property="og:description" content="Curated fashion for the modern individual. Premium leggings, sneakers, accessories & more. Cash on delivery.">
<meta property="og:image" content="https://images.unsplash.com/photo-1483985988355-763728e1935b?w=1200&h=630&fit=crop">
<meta property="og:url" content="https://novafashion.store/">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="NOVA ‚Äì Style That Speaks Before You Do">
<meta name="twitter:description" content="Curated fashion for the modern individual. Premium leggings, sneakers, accessories & more.">
<meta name="twitter:image" content="https://images.unsplash.com/photo-1483985988355-763728e1935b?w=1200&h=630&fit=crop">

<!-- JSON-LD Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Organization",
      "@id": "https://novafashion.store/#organization",
      "name": "NOVA Fashion",
      "url": "https://novafashion.store/",
      "logo": "https://novafashion.store/logo.png",
      "description": "Curated fashion store offering premium leggings, sneakers, accessories, arm sleeves and T-shirts.",
      "sameAs": [
        "https://instagram.com/novafashion",
        "https://tiktok.com/@novafashion",
        "https://facebook.com/novafashion"
      ],
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "customer support",
        "availableLanguage": ["English", "Arabic"]
      }
    },
    {
      "@type": "WebSite",
      "@id": "https://novafashion.store/#website",
      "url": "https://novafashion.store/",
      "name": "NOVA Fashion",
      "publisher": { "@id": "https://novafashion.store/#organization" },
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://novafashion.store/?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    },
    {
      "@type": "Store",
      "name": "NOVA Fashion",
      "url": "https://novafashion.store/",
      "currenciesAccepted": "USD",
      "paymentAccepted": "Cash on Delivery",
      "priceRange": "$$",
      "hasOfferCatalog": {
        "@type": "OfferCatalog",
        "name": "NOVA Fashion Collection",
        "itemListElement": [
          { "@type": "OfferCatalog", "name": "Accessories" },
          { "@type": "OfferCatalog", "name": "Shoes" },
          { "@type": "OfferCatalog", "name": "Leggings" },
          { "@type": "OfferCatalog", "name": "T-Shirts" },
          { "@type": "OfferCatalog", "name": "Arm Sleeves" }
        ]
      }
    }
  ]
}
</script>

<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=DM+Sans:wght@300;400;500&family=Noto+Kufi+Arabic:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<!-- Anti-flash: set theme + direction before CSS loads -->
<script>
(function() {
  try {
    var th = localStorage.getItem('nova_theme');
    if (!th) th = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    document.documentElement.setAttribute('data-theme', th);
    if (localStorage.getItem('nova_lang') === 'ar') {
      document.documentElement.setAttribute('dir', 'rtl');
      document.documentElement.setAttribute('lang', 'ar');
    }
  } catch(e) {}
})();
</script>

<link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="extras.css">
<script src="products.js"></script>
<script src="i18n.js"></script>
</head>
<body>
<!-- SCROLL PROGRESS -->
<div id="scroll-progress" aria-hidden="true"></div>

<!-- HEADER -->
<header>
  <div class="logo">NO<span>VA</span></div>
  <nav id="main-nav">
    <button class="cat-nav active" data-cat="All">All</button>
    <button class="cat-nav" data-cat="Accessories">Accessories</button>
    <button class="cat-nav" data-cat="Shoes">Shoes</button>
    <button class="cat-nav" data-cat="Leggings">Leggings</button>
    <button class="cat-nav" data-cat="T-Shirts">T-Shirts</button>
    <button class="cat-nav" data-cat="Arm Sleeves">Arm Sleeves</button>
  </nav>
  <div class="header-right">
    <div class="lang-toggle">
      <button class="lang-btn active" id="lang-en" onclick="setLang('en')">EN</button>
      <button class="lang-btn" id="lang-ar" onclick="setLang('ar')">ÿπ</button>
    </div>
    <button class="theme-toggle-btn" id="theme-toggle" aria-label="Toggle dark mode">
      <svg class="icon-moon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"/></svg>
      <svg class="icon-sun" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="5"/>
        <line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/>
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
        <line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/>
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
      </svg>
    </button>
    <button class="wish-btn-header" id="open-wishlist" title="Wishlist">
      <svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
      <span class="wish-count" id="wish-count">0</span>
    </button>
    <button class="cart-btn" id="open-cart">üõç<span class="cart-count" id="cart-count">0</span></button>
  </div>
</header>

<!-- HERO -->
<section id="hero">
  <h1 data-i18n="hero.title"></h1>
  <p data-i18n="hero.subtitle"></p>
  <div class="hero-btns">
    <button class="btn-primary" data-i18n="hero.shopNow" onclick="document.getElementById('shop').scrollIntoView({behavior:'smooth'})"></button>
    <button class="btn-outline" onclick="filterProducts('Accessories')"></button>
  </div>
</section>

<!-- TRUST BAR -->
<div class="trust-bar" id="trust-bar" role="list" aria-label="Store trust signals"></div>

<!-- SHOP -->
<section id="shop">
  <h2 class="section-title" data-i18n="shop.title"></h2>
  <p class="section-sub" data-i18n="shop.subtitle"></p>
  <div class="categories" id="category-pills">
    <button class="cat-pill active" data-cat="All"></button>
    <button class="cat-pill" data-cat="Accessories"></button>
    <button class="cat-pill" data-cat="Shoes"></button>
    <button class="cat-pill" data-cat="Leggings"></button>
    <button class="cat-pill" data-cat="T-Shirts"></button>
    <button class="cat-pill" data-cat="Arm Sleeves"></button>
  </div>
  <div class="shop-controls">
    <div class="search-wrap">
      <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <input class="search-input" id="search-input" type="text">
    </div>
    <select class="sort-select" id="sort-select">
      <option value="default"    data-i18n="sort.default"></option>
      <option value="price-asc"  data-i18n="sort.priceAsc"></option>
      <option value="price-desc" data-i18n="sort.priceDesc"></option>
      <option value="discount"   data-i18n="sort.discount"></option>
    </select>
  </div>
  <!-- CATEGORY BREADCRUMB -->
  <div id="category-breadcrumb" aria-live="polite">
    <span>All Items</span>
    <span class="bc-sep">‚Ä∫</span>
    <span class="bc-active" id="bc-label"></span>
    <button class="bc-clear" onclick="filterProducts('All')" aria-label="Clear filter">‚úï</button>
  </div>
  <p class="result-count" id="result-count"></p>
  <div class="product-grid" id="product-grid"></div>
</section>

<!-- PRODUCT MODAL -->
<div class="overlay" id="product-overlay">
  <div class="modal">
    <div class="modal-img-section">
      <div class="modal-img-main" id="modal-img-main">
        <img id="modal-img" src="" alt="">
        <div class="zoom-lens"   id="zoom-lens"></div>
        <div class="zoom-result" id="zoom-result"></div>
        <span class="zoom-hint">üîç</span>
      </div>
      <div class="modal-thumbnails" id="modal-thumbnails"></div>
    </div>
    <div class="modal-info">
      <button class="modal-close" id="close-modal">&#x2715;</button>
      <p class="modal-cat" id="modal-cat"></p>
      <h2 class="modal-name" id="modal-name"></h2>
      <div class="modal-price">
        <span class="modal-price-now" id="modal-price-now"></span>
        <span class="modal-price-old" id="modal-price-old"></span>
        <span class="modal-discount" id="modal-discount"></span>
      </div>
      <p class="modal-desc" id="modal-desc"></p>
      <p class="modal-stock" id="modal-stock"></p>
      <div id="modal-color-section" style="display:none;margin-bottom:1.2rem;">
        <p class="color-label">
          <span data-i18n="modal.selectColor"></span>:
          <span class="selected-color-name" id="selected-color-name"></span>
        </p>
        <div class="color-palette" id="modal-colors"></div>
      </div>
      <div class="size-label-row">
        <p class="size-label" data-i18n="modal.selectSize"></p>
        <button class="size-guide-btn" id="size-guide-btn" onclick="openSizeGuide()" style="display:none"></button>
      </div>
      <div class="sizes" id="modal-sizes"></div>
      <button class="add-to-cart-btn" id="add-to-cart-btn"></button>
      <button class="modal-share-btn" id="share-btn" onclick="shareProduct()" aria-label="Share product">
        <svg viewBox="0 0 24 24"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
        Share
      </button>

      <!-- ‚ë• YOU MIGHT ALSO LIKE -->
      <div class="modal-related" id="modal-related" style="display:none;">
        <p class="modal-related-title" id="modal-related-title"></p>
        <div class="modal-related-grid" id="modal-related-grid"></div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ë§ SIZE GUIDE OVERLAY -->
<div class="size-guide-overlay" id="size-guide-overlay" onclick="if(event.target===this)closeSizeGuide()">
  <div class="size-guide-box">
    <div class="size-guide-head">
      <h3 id="size-guide-title"></h3>
      <button class="size-guide-close" onclick="closeSizeGuide()">&#x2715;</button>
    </div>
    <div class="size-guide-body">
      <table class="size-guide-table" id="size-guide-table"></table>
      <p class="size-guide-tip" id="size-guide-tip"></p>
    </div>
  </div>
</div>

<!-- ‚ë£ ZOOM LIGHTBOX -->
<div class="zoom-lightbox" id="zoom-lightbox" onclick="if(event.target===this)closeLightbox()">
  <button class="zoom-lb-close" onclick="closeLightbox()">&#x2715;</button>
  <img id="zoom-lightbox-img" src="" alt="">
</div>

<!-- CART PANEL -->
<div class="cart-overlay-bg" id="cart-overlay-bg"></div>
<div class="cart-panel" id="cart-panel">
  <div class="cart-head">
    <h2 data-i18n="cart.title"></h2>
    <button id="close-cart" style="font-size:1.4rem;color:var(--text-muted)">&#x2715;</button>
  </div>
  <div class="cart-body" id="cart-body"></div>
  <div class="cart-foot" id="cart-foot" style="display:none">
    <div class="cart-total">
      <span data-i18n="cart.total"></span>
      <span id="cart-total-price">$0</span>
    </div>
    <button class="checkout-btn" id="checkout-btn" data-i18n="cart.checkout"></button>
  </div>
</div>

<!-- WISHLIST PANEL -->
<div class="cart-overlay-bg" id="wish-overlay-bg"></div>
<div class="wish-panel" id="wish-panel">
  <div class="wish-head">
    <h2 data-i18n="wish.title"></h2>
    <button id="close-wishlist" style="font-size:1.4rem;color:var(--text-muted)">&#x2715;</button>
  </div>
  <div class="wish-body" id="wish-body"></div>
</div>

<!-- CHECKOUT MODAL -->
<div class="checkout-overlay" id="checkout-overlay">
  <div class="checkout-box">
    <div id="checkout-form-area">
      <h2 data-i18n="checkout.title"></h2>
      <p data-i18n="checkout.subtitle"></p>
      <div class="order-summary" id="checkout-summary"></div>
      <div class="form-group">
        <label data-i18n="checkout.name"></label>
        <input type="text" id="c-name" required>
      </div>
      <div class="form-group">
        <label data-i18n="checkout.address"></label>
        <textarea id="c-address" rows="3"></textarea>
      </div>
      <div class="form-group">
        <label data-i18n="checkout.phone"></label>
        <input type="tel" id="c-phone" placeholder="+1 234 567 8900" required>
      </div>
      <button class="place-order-btn" id="place-order-btn" data-i18n="checkout.placeOrder"></button>
      <button class="cancel-btn" id="cancel-checkout" data-i18n="checkout.cancel"></button>
    </div>
    <div id="checkout-success" class="success-screen" style="display:none">
      <div class="success-icon">&#x2705;</div>
      <h2 data-i18n="success.title"></h2>
      <p data-i18n="success.message"></p>
      <button class="btn-primary" style="margin-top:1.5rem;display:inline-block" id="close-success" data-i18n="success.continue"></button>
    </div>
  </div>
</div>

<div class="toast-container" id="toast-container"></div>

<!-- CUSTOMER REVIEWS -->
<section class="reviews-section" id="reviews-section" aria-labelledby="reviews-heading">
  <h2 id="reviews-heading"></h2>
  <p class="sub"></p>
  <div class="rating-summary">
    <div class="rating-big">4.8</div>
    <div class="rating-details">
      <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
      <div></div>
      <small>Verified purchases only</small>
    </div>
  </div>
  <div class="reviews-grid"></div>
</section>

<!-- DELIVERY & RETURN POLICY -->
<div class="info-sections">
  <section class="info-card" id="delivery-info" aria-labelledby="delivery-heading">
    <h3 id="delivery-heading"></h3>
    <ul></ul>
  </section>
  <section class="info-card" id="returns-info" aria-labelledby="returns-heading">
    <h3 id="returns-heading"></h3>
    <ul></ul>
  </section>
</div>

<!-- WHATSAPP FLOATING BUTTON -->
<a href="https://wa.me/1234567890?text=Hi%20NOVA!%20I%20have%20a%20question%20about%20my%20order."
   class="whatsapp-float"
   target="_blank" rel="noopener noreferrer"
   aria-label="Chat with us on WhatsApp"
   title="Chat on WhatsApp">
  <div class="whatsapp-pulse"></div>
  <div class="whatsapp-tooltip">Chat with us! üí¨</div>
  <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
  </svg>
</a>

<!-- BACK TO TOP -->
<button id="back-to-top" aria-label="Back to top">
  <svg viewBox="0 0 24 24"><polyline points="18 15 12 9 6 15"/></svg>
</button>

<!-- BOTTOM NAV (mobile only) -->
<nav class="bottom-nav" id="bottom-nav" aria-label="Mobile navigation">
  <button class="bn-item active" id="bn-home"
    onclick="window.scrollTo({top:0,behavior:'smooth'})">
    <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
    <span>Home</span>
  </button>
  <button class="bn-item" id="bn-search"
    onclick="document.getElementById('shop').scrollIntoView({behavior:'smooth'});setTimeout(()=>document.getElementById('search-input').focus(),400)">
    <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
    <span>Search</span>
  </button>
  <button class="bn-item" id="bn-cart" onclick="openCart()">
    <svg viewBox="0 0 24 24"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg>
    <span>Cart</span>
    <span class="bn-badge" id="bn-cart-badge">0</span>
  </button>
  <button class="bn-item" id="bn-wish" onclick="openWishlist()">
    <svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
    <span>Wishlist</span>
    <span class="bn-badge" id="bn-wish-badge">0</span>
  </button>
</nav>

<!-- FOOTER -->
<footer>
  <div class="footer-inner">
    <div class="footer-logo">NO<span>VA</span></div>
    <p class="footer-tagline" data-i18n="footer.tagline"></p>
    <div class="social-links">
      <a href="https://instagram.com" target="_blank" rel="noopener" class="social-link" aria-label="Instagram">
        <svg viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
      </a>
      <a href="https://tiktok.com" target="_blank" rel="noopener" class="social-link" aria-label="TikTok">
        <svg viewBox="0 0 24 24"><path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-2.88 2.5 2.89 2.89 0 01-2.89-2.89 2.89 2.89 0 012.89-2.89c.28 0 .54.04.79.1V9.01a6.27 6.27 0 00-.79-.05 6.34 6.34 0 00-6.34 6.34 6.34 6.34 0 006.34 6.34 6.34 6.34 0 006.33-6.34V8.69a8.18 8.18 0 004.78 1.52V6.77a4.85 4.85 0 01-1.01-.08z"/></svg>
      </a>
      <a href="https://facebook.com" target="_blank" rel="noopener" class="social-link" aria-label="Facebook">
        <svg viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
      </a>
    </div>
    <hr class="footer-divider">
    <p class="footer-bottom"><strong>NOVA</strong> <span data-i18n="footer.copy"></span></p>
  </div>
</footer>

<!--
  SCRIPT LOAD ORDER:
  1. products.js + i18n.js  ‚Äî already loaded in <head> (data only)
  2. External modules below  ‚Äî pure function definitions, safe to load before state
  3. Inline script           ‚Äî state + storage + utils + events + init() (runs last)

  Why external modules load before state is fine:
  Function *definitions* are hoisted and parsed but not executed.
  By the time any function is actually *called* (in init()), all state exists.
-->
<script src="lang.js"></script>
<script src="cart.js"></script>
<script src="shop.js"></script>
<script src="modal.js"></script>
<script src="checkout.js"></script>
<script src="darkTheme.js"></script>
<script src="trustBar.js"></script>
<script src="reviews.js"></script>
<script src="infoSections.js"></script>
<script src="engagement.js"></script>
<script src="analytics.js"></script>
<script>
/* ‚îÄ‚îÄ EMAILJS ‚îÄ‚îÄ */
const EMAILJS_SERVICE_ID  = 'service_9x2l0cl';
const EMAILJS_TEMPLATE_ID = 'template_xgwftzp';
const EMAILJS_PUBLIC_KEY  = 'Z5bnNfX8i2DocKic6';
emailjs.init(EMAILJS_PUBLIC_KEY);

/* ‚îÄ‚îÄ STATE ‚îÄ‚îÄ */
let products         = PRODUCTS;
let i18n             = I18N;
let cart             = [];
let wishlist         = [];
let currentProduct   = null;
let selectedSize     = null;
let selectedColorIdx = 0;
let currentFilter    = 'All';
let currentLang      = 'en';
let currentSearch    = '';
let currentSort      = 'default';
const cardColorState = {};

/* ‚îÄ‚îÄ UTILITIES ‚îÄ‚îÄ */
const fmt = price => `$${price.toFixed(2)}`;

function t(key, vars = {}) {
  let str = (i18n[currentLang]?.[key]) || (i18n['en']?.[key]) || key;
  Object.entries(vars).forEach(([k, v]) => { str = str.replace(`{${k}}`, v); });
  return str;
}
function getName(p)      { return typeof p.name === 'object' ? (p.name[currentLang] || p.name.en) : p.name; }
function getDesc(p)      { return typeof p.desc === 'object' ? (p.desc[currentLang]  || p.desc.en)  : p.desc; }
function getColorName(c) { return typeof c.name === 'object' ? (c.name[currentLang] || c.name.en) : c.name; }
function getCurrentImage(product, colorIdx) {
  if (product.colors?.[colorIdx]) return product.colors[colorIdx].images[0];
  return product.image || '';
}
function getStockStatus(product, size) {
  if (product.stock === 0) return { label: t('modal.soldOut'), cls: 'stock-none' };
  if (product.sizeStock && size) {
    const s = product.sizeStock[size];
    if (s === 0) return { label: t('modal.outOfStockSize'), cls: 'stock-none' };
    if (s <= 3)  return { label: t('modal.lowStockSize', { n: s }), cls: 'stock-low' };
    return { label: t('modal.inStock'), cls: 'stock-ok' };
  }
  if (product.stock <= 3) return { label: t('modal.lowStock', { n: product.stock }), cls: 'stock-low' };
  return { label: t('modal.inStock'), cls: 'stock-ok' };
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   URL PARAMS ‚Äî #18 Shareable URLs
   Tracks both ?category=X&product=Y
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function getURLParam(key) { return new URLSearchParams(window.location.search).get(key); }
function setURLParam(key, val) {
  const url = new URL(window.location);
  if (val !== null && val !== undefined && val !== '') {
    url.searchParams.set(key, val);
  } else {
    url.searchParams.delete(key);
  }
  history.replaceState({}, '', url);
}

/* ‚îÄ‚îÄ STORAGE ‚îÄ‚îÄ */
function saveCart() {
  try { localStorage.setItem('nova_cart', JSON.stringify(cart.map(i => ({ ...i, productRef: null })))); } catch(e) {}
}
function loadCart() {
  try {
    const raw = localStorage.getItem('nova_cart');
    if (!raw) return;
    cart = JSON.parse(raw).map(item => ({ ...item, productRef: products.find(p => p.id === item.id) || null }));
  } catch(e) { cart = []; }
}
function saveWishlist() {
  try { localStorage.setItem('nova_wishlist', JSON.stringify(wishlist)); } catch(e) {}
}
function loadWishlist() {
  try { const raw = localStorage.getItem('nova_wishlist'); wishlist = raw ? JSON.parse(raw) : []; }
  catch(e) { wishlist = []; }
}
function saveLang(lang) { try { localStorage.setItem('nova_lang', lang); } catch(e) {} }
function loadLang()     { try { return localStorage.getItem('nova_lang') || 'en'; } catch(e) { return 'en'; } }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
function showToast(msg, type = '') {
  const el = document.createElement('div');
  el.className = `toast${type ? ' ' + type : ''}`;
  el.textContent = msg;
  document.getElementById('toast-container').appendChild(el);
  setTimeout(() => el.remove(), 2600);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   #14 SCROLL PROGRESS BAR
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function updateScrollProgress() {
  const h   = document.documentElement;
  const pct = h.scrollHeight === h.clientHeight ? 0
            : (window.scrollY / (h.scrollHeight - h.clientHeight)) * 100;
  const bar = document.getElementById('scroll-progress');
  if (bar) bar.style.width = Math.min(100, pct) + '%';
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   #17 BACK TO TOP
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function updateBackToTop() {
  const btn = document.getElementById('back-to-top');
  if (!btn) return;
  btn.classList.toggle('visible', window.scrollY > 360);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   #15 CATEGORY BREADCRUMB
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function updateBreadcrumb() {
  const el  = document.getElementById('category-breadcrumb');
  const lbl = document.getElementById('bc-label');
  if (!el) return;
  if (currentFilter === 'All') {
    el.classList.remove('visible');
  } else {
    if (lbl) lbl.textContent = t('cat.' + currentFilter);
    el.classList.add('visible');
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   BOTTOM NAV BADGE SYNC
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function syncBottomNav() {
  const cartCount = cart.reduce((s, i) => s + i.qty, 0);
  const wishCount = wishlist.length;
  const cb = document.getElementById('bn-cart-badge');
  const wb = document.getElementById('bn-wish-badge');
  if (cb) { cb.textContent = cartCount; cb.classList.toggle('show', cartCount > 0); }
  if (wb) { wb.textContent = wishCount;  wb.classList.toggle('show', wishCount > 0); }
  // Highlight home when at top
  const homeBtn = document.getElementById('bn-home');
  if (homeBtn) homeBtn.classList.toggle('active', window.scrollY < 100);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   #19 SHARE PRODUCT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function shareProduct() {
  if (!currentProduct) return;
  const url = new URL(window.location.href);
  url.searchParams.set('product', currentProduct.id);
  if (currentFilter !== 'All') url.searchParams.set('category', currentFilter);
  const shareUrl = url.toString();
  const title    = getName(currentProduct);

  if (navigator.share) {
    navigator.share({ title, url: shareUrl })
      .catch(() => {}); // user dismissed ‚Äî ignore
  } else {
    navigator.clipboard.writeText(shareUrl).then(() => {
      showToast('üîó Link copied to clipboard!', 'green');
    }).catch(() => {
      // Fallback: select text in a temp input
      const inp = document.createElement('input');
      inp.value = shareUrl;
      document.body.appendChild(inp);
      inp.select();
      document.execCommand('copy');
      inp.remove();
      showToast('üîó Link copied!', 'green');
    });
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   #16 BLUR-UP IMAGE PLACEHOLDER
   Called from Shop.js renderProducts via
   image onload events (patched below)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function blurUpObserve() {
  // After renderProducts runs, wire up all card images for blur-up
  requestAnimationFrame(() => {
    document.querySelectorAll('.card-img-primary').forEach(img => {
      if (img.dataset.blurInit) return;
      img.dataset.blurInit = '1';
      if (img.complete && img.naturalHeight > 0) return; // already loaded
      img.style.filter = 'blur(10px)';
      img.style.transform = 'scale(1.05)';
      img.style.transition = 'filter 0.45s ease, transform 0.45s ease, opacity 0.42s ease';
      img.addEventListener('load', function onLoad() {
        img.style.filter    = '';
        img.style.transform = '';
        img.removeEventListener('load', onLoad);
      }, { once: true });
    });
  });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PATCH filterProducts (from Shop.js)
   ‚Äî also update URL + breadcrumb
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
// We wrap after DOMContentLoaded (filterProducts defined in Shop.js)
function _patchFilterProducts() {
  const orig = window.filterProducts;
  if (!orig) return;
  window.filterProducts = function(cat) {
    orig(cat);
    // #18 reflect category in URL
    setURLParam('category', cat === 'All' ? '' : cat);
    // #15 breadcrumb
    updateBreadcrumb();
    // bottom nav badge
    syncBottomNav();
  };
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PATCH updateCartUI / updateWishlistUI
   ‚Äî sync bottom nav badges
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function _patchCartAndWish() {
  const origCart = window.updateCartUI;
  if (origCart) {
    window.updateCartUI = function() {
      origCart();
      syncBottomNav();
    };
  }
  const origWish = window.updateWishlistUI;
  if (origWish) {
    window.updateWishlistUI = function() {
      origWish();
      syncBottomNav();
    };
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   #9 SWIPE GESTURES ON MODAL GALLERY
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function initModalSwipe() {
  let startX = 0, startY = 0;
  const overlay = document.getElementById('product-overlay');
  overlay.addEventListener('touchstart', e => {
    startX = e.touches[0].clientX;
    startY = e.touches[0].clientY;
  }, { passive: true });
  overlay.addEventListener('touchend', e => {
    if (!currentProduct) return;
    const dx = e.changedTouches[0].clientX - startX;
    const dy = e.changedTouches[0].clientY - startY;
    if (Math.abs(dx) < 45 || Math.abs(dy) > Math.abs(dx) * 0.9) return;
    const images = currentProduct.colors?.[selectedColorIdx]?.images || [];
    if (images.length < 2) return;
    const mainSrc = document.getElementById('modal-img')?.src || '';
    let idx = images.findIndex(u => mainSrc.includes(u.split('?')[0]));
    if (idx < 0) idx = 0;
    idx = dx < 0
      ? (idx + 1) % images.length
      : (idx - 1 + images.length) % images.length;
    const thumbs = document.querySelectorAll('.modal-thumb');
    if (thumbs[idx]) thumbs[idx].click();
  }, { passive: true });
}

/* ‚îÄ‚îÄ EVENT LISTENERS ‚îÄ‚îÄ */
document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
document.getElementById('close-modal').addEventListener('click', closeProduct);
document.getElementById('product-overlay').addEventListener('click', e => {
  if (e.target === document.getElementById('product-overlay')) closeProduct();
});
document.getElementById('add-to-cart-btn').addEventListener('click', addToCart);
document.getElementById('open-cart').addEventListener('click', openCart);
document.getElementById('close-cart').addEventListener('click', closeCart);
document.getElementById('cart-overlay-bg').addEventListener('click', closeCart);
document.getElementById('checkout-btn').addEventListener('click', openCheckout);
document.getElementById('cancel-checkout').addEventListener('click', closeCheckout);
document.getElementById('place-order-btn').addEventListener('click', placeOrder);
document.getElementById('close-success').addEventListener('click', closeCheckout);
document.getElementById('open-wishlist').addEventListener('click', openWishlist);
document.getElementById('close-wishlist').addEventListener('click', closeWishlist);
document.getElementById('wish-overlay-bg').addEventListener('click', closeWishlist);
document.querySelectorAll('.cat-pill').forEach(b => b.addEventListener('click', () => filterProducts(b.dataset.cat)));
document.querySelectorAll('.cat-nav').forEach(b => b.addEventListener('click', () => filterProducts(b.dataset.cat)));
document.getElementById('search-input').addEventListener('input', e => { currentSearch = e.target.value; renderProducts(); });
document.getElementById('sort-select').addEventListener('change', e => { currentSort = e.target.value; renderProducts(); });

/* Back to top */
document.getElementById('back-to-top').addEventListener('click', () =>
  window.scrollTo({ top: 0, behavior: 'smooth' })
);

/* Scroll handler */
window.addEventListener('scroll', () => {
  updateScrollProgress();
  updateBackToTop();
  syncBottomNav();
}, { passive: true });

/* ‚îÄ‚îÄ INIT ‚îÄ‚îÄ */
function init() {
  currentLang = loadLang();
  const html = document.documentElement;
  if (currentLang === 'ar') {
    html.setAttribute('dir', 'rtl'); html.setAttribute('lang', 'ar');
    document.body.setAttribute('dir', 'rtl');
  } else {
    html.setAttribute('dir', 'ltr'); html.setAttribute('lang', 'en');
  }
  document.getElementById('lang-en').classList.toggle('active', currentLang === 'en');
  document.getElementById('lang-ar').classList.toggle('active', currentLang === 'ar');

  loadCart();
  loadWishlist();
  applyTranslations();
  renderTrustBar();
  renderInfoSections();
  renderReviews();
  renderWhatsApp();

  /* Patch after all modules loaded */
  _patchFilterProducts();
  _patchCartAndWish();

  /* #18 Restore category from URL */
  const urlCat = getURLParam('category');
  if (urlCat && urlCat !== 'All') {
    currentFilter = urlCat;
    document.querySelectorAll('.cat-pill,.cat-nav').forEach(b =>
      b.classList.toggle('active', b.dataset.cat === urlCat)
    );
  }

  renderProducts();
  blurUpObserve();
  updateCartUI();
  updateWishlistUI();
  updateBreadcrumb();
  updateScrollProgress();
  updateBackToTop();
  syncBottomNav();

  initModalSwipe();

  /* #18 Restore product from URL */
  const urlProduct = getURLParam('product');
  if (urlProduct) openProduct(urlProduct);
}

init();
</script>
</body>
</html>